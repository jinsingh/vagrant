#!/bin/bash

set -xe

export LD_LIBRARY_PATH="/usr/lib/oracle/12.1/client64/lib/:/opt/capd-siti-linux-dataloader/"

sqlplus -s siti/<%= scope.function_hiera(['abaco-db-siti-password']) %>@<%= scope.function_hiera(['capd-oracle-sid']) %><<EOF

DELETE FROM defra_eng_boundary_detailed;
quit
EOF

./shp2ora -d "//<%= scope.function_hiera(['caporacledb-ip-host']) %>:<%= scope.function_hiera(["oracle-port"]) %>/<%= scope.function_hiera(['capd-oracle-sid']) %>" -u siti -p <%= scope.function_hiera(['abaco-db-siti-password']) %> -t defra_eng_boundary_detailed -l defra_eng_boundary_detailed.log -f <%= scope.function_hiera(['abaco-temp-datadir','/opt/capd-siti-data']) %>/defra_eng_boundary_detailed.shp -c load-England_detailed.cfg
