#<VirtualHost <%= @kibana_ext_ip %>:80>
#  ServerName <%= @kibana_serv_name %>
#  RewriteEngine On
#  RewriteCond %{HTTPS} off
#  RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}
#</VirtualHost>
#
# SSL ON HOLD UNTIL NEW MERGE REQ IS ACCEPTED FOR jetty as it's broken with es 0.90.10
#
#<VirtualHost <%= @kibana_ext_ip %>:443>
<VirtualHost <%= @kibana_ext_ip %>:80>
  ServerName <%= @kibana_serv_name %>

  #SSLEngine on
  #SSLCertificateFile      /opt/kibana/ssl.crt
  #SSLCertificateKeyFile   /opt/kibana/ssl.key

  DocumentRoot /opt/kibana
  <Directory /opt/kibana>
    AuthName "Add your login message here."
    AuthType Basic
    AuthUserFile /var/www/users
    Require valid-user
    Allow from all
    Options -Multiviews

  </Directory>

  LogLevel debug
  ErrorLog /var/log/error_log
  CustomLog /var/log/access_log combined

  # Set global proxy timeouts
  <Proxy http://127.0.0.1:9200>
    AuthName "Add your login message here."
    AuthType Basic
    AuthUserFile /var/www/users
    Require valid-user
    ProxySet connectiontimeout=5 timeout=90
  </Proxy>

  # Proxy for _aliases and .*/_search
  <LocationMatch "^/(_nodes|_aliases|.*/_aliases|_search|.*/_search|_mapping|.*/_mapping)$">
    ProxyPassMatch http://127.0.0.1:9200/$1
    ProxyPassReverse http://127.0.0.1:9200/$1
  </LocationMatch>

  # Proxy for kibana-int/{dashboard,temp} stuff (if you don't want auth on /, then you will want these to be protected)
  <LocationMatch "^/(kibana-int/dashboard/|kibana-int/temp)(.*)$">
    ProxyPassMatch http://127.0.0.1:9200/$1$2
    ProxyPassReverse http://127.0.0.1:9200/$1$2
  </LocationMatch>

  </VirtualHost>